<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>自选集✨ | 階上生活</title>
    <style>
body {
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #121212;
    color: #fff;
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 20px;
}

.playlist {
    width: 80%;
    max-width: 1200px;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin: 0 auto;
}

th, td {
    padding: 10px;
    text-align: left;
    white-space: nowrap;
}

th {
    border-bottom: 1px solid #fff;
    font-size: 14px;
}

td {
    font-size: 14px;
    border-bottom: 1px solid #333;
}

.album-cover-container {
    position: relative;
    width: 50px;
    height: 50px;
    border-radius: 3px;
    overflow: hidden;
    margin-right: 10px;
}

.album-cover {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: all 0.3s ease;
}

.album-cover-container:hover .album-cover {
    filter: blur(3px) brightness(0.5);
}

.album-cover-container:hover .popularity-overlay {
    opacity: 1;
}

.popularity-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0, 0, 0, 0.5);
    color: #fff;
    font-size: 24px;
    font-weight: 800;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.song-info {
    display: flex;
    align-items: center;
}

.song-info img {
    margin-right: 10px;
}

.song-details {
    display: flex;
    flex-direction: column;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.song-name {
    font-weight: bold;
    color: #1db954;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.song-name a {
    color: inherit;
    text-decoration: none;
}

.song-name a:hover {
    text-decoration: underline;
}

.singer-name, .album-name {
    color: #b3b3b3;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.relative-time, .track-duration {
    color: #b3b3b3;
    text-align: center;
}

/* Mobile Styles */
@media (max-width: 768px) {
    table {
        width: 100%;
    }
    th, td {
        padding: 8px;
    }
    th:nth-child(1),
    th:nth-child(3),
    th:nth-child(5),
    td:nth-child(1),
    td:nth-child(3),
    td:nth-child(5) {
        display: none;
    }
    th, td {
        text-align: center;
    }
}
    </style>
</head>
<body>
    <div class="playlist" id="playlist">
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>标题</th>
                    <th>专辑</th>
                    <th>添加日期</th>
                    <th>持续时间</th>
                </tr>
            </thead>
            <tbody id="playlist-body">
                <!-- 动态生成内容 -->
            </tbody>
        </table>
    </div>

    <script>
        async function fetchPlaylist() {
            const response = await fetch('./liked_tracks.json');
            const playlist = await response.json();
            const playlistBody = document.getElementById('playlist-body');

            // Sort the playlist by added_at in descending order
            playlist.sort((a, b) => new Date(b.added_at) - new Date(a.added_at));

            playlist.forEach((song, index) => {
                const row = document.createElement('tr');

                const cellIndex = document.createElement('td');
                cellIndex.textContent = index + 1;
                row.appendChild(cellIndex);

                const cellSongInfo = document.createElement('td');
                const songInfoDiv = document.createElement('div');
                songInfoDiv.className = 'song-info';

                const albumCoverContainer = document.createElement('div');
                albumCoverContainer.className = 'album-cover-container';

                const albumCoverImg = document.createElement('img');
                albumCoverImg.src = song.album_cover_url;
                albumCoverImg.alt = song.album_name;
                albumCoverImg.className = 'album-cover';
                albumCoverContainer.appendChild(albumCoverImg);

                const popularityOverlay = document.createElement('div');
                popularityOverlay.className = 'popularity-overlay';
                popularityOverlay.textContent = song.popularity;
                albumCoverContainer.appendChild(popularityOverlay);

                songInfoDiv.appendChild(albumCoverContainer);

                const songDetailsDiv = document.createElement('div');
                songDetailsDiv.className = 'song-details';

                const songNameDiv = document.createElement('div');
                songNameDiv.className = 'song-name';
                const songLink = document.createElement('a');
                songLink.href = song.track_url;
                songLink.textContent = song.song_name;
                songLink.target = "_blank";
                songNameDiv.appendChild(songLink);
                songDetailsDiv.appendChild(songNameDiv);

                const singerNameDiv = document.createElement('div');
                singerNameDiv.className = 'singer-name';
                singerNameDiv.textContent = song.singer_name;
                songDetailsDiv.appendChild(singerNameDiv);

                songInfoDiv.appendChild(songDetailsDiv);
                cellSongInfo.appendChild(songInfoDiv);
                row.appendChild(cellSongInfo);

                const cellAlbumName = document.createElement('td');
                cellAlbumName.textContent = song.album_name;
                cellAlbumName.className = 'album-name';
                row.appendChild(cellAlbumName);

                const cellAddedAt = document.createElement('td');
                cellAddedAt.textContent = formatRelativeTime(song.added_at);
                cellAddedAt.className = 'relative-time';
                row.appendChild(cellAddedAt);

                const cellDuration = document.createElement('td');
                cellDuration.textContent = formatDuration(song.track_duration_ms);
                cellDuration.className = 'track-duration';
                row.appendChild(cellDuration);

                playlistBody.appendChild(row);
            });
        }

        function formatDuration(ms) {
            const minutes = Math.floor(ms / 60000);
            const seconds = ((ms % 60000) / 1000).toFixed(0);
            return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        }

        function formatRelativeTime(datetime) {
            const now = new Date();
            const then = new Date(datetime);
            const diffInSeconds = Math.floor((now - then) / 1000);

            const minutes = Math.floor(diffInSeconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);

            if (days > 0) {
                return `${days}天前`;
            } else if (hours > 0) {
                return `${hours}小时前`;
            } else if (minutes > 0) {
                return `${minutes}分钟前`;
            } else {
                return '刚刚';
            }
        }

        fetchPlaylist();
    </script>
</body>
</html>
